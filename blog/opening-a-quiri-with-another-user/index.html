<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/quiri-docs/blog/rss.xml" title="Quiri Docs and Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/quiri-docs/blog/atom.xml" title="Quiri Docs and Blog Atom Feed"><title data-rh="true">Opening a Quiri with Another User | Quiri Docs and Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://quiri-io.github.io/quiri-docs/blog/opening-a-quiri-with-another-user"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Opening a Quiri with Another User | Quiri Docs and Blog"><meta data-rh="true" name="description" content="The Problem"><meta data-rh="true" property="og:description" content="The Problem"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-12-04T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/nigel-smk"><meta data-rh="true" property="article:tag" content="quiri,solutioning"><link data-rh="true" rel="icon" href="/quiri-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://quiri-io.github.io/quiri-docs/blog/opening-a-quiri-with-another-user"><link data-rh="true" rel="alternate" href="https://quiri-io.github.io/quiri-docs/blog/opening-a-quiri-with-another-user" hreflang="en"><link data-rh="true" rel="alternate" href="https://quiri-io.github.io/quiri-docs/blog/opening-a-quiri-with-another-user" hreflang="x-default"><link rel="stylesheet" href="/quiri-docs/assets/css/styles.e9529800.css">
<link rel="preload" href="/quiri-docs/assets/js/runtime~main.2e6ac7e9.js" as="script">
<link rel="preload" href="/quiri-docs/assets/js/main.f573e6b0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/quiri-docs/"><div class="navbar__logo"><img src="/quiri-docs/img/quiri_logo.svg" alt="Quiri Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/quiri-docs/img/quiri_logo.svg" alt="Quiri Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Quiri.dev</b></a><a class="navbar__item navbar__link" href="/quiri-docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/quiri-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/quiri-io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/streaming-repositories-with-bloc">Streaming Repositories With Bloc</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/listening-for-new-messages-with-the-matrix-sdk">Listening for New Messages With the Matrix SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/sending-and-accepting-room-invites">Sending and Accepting Room Invites</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/quiri-docs/blog/opening-a-quiri-with-another-user">Opening a Quiri with Another User</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/starting-and-restarting-sessions">Starting and Restarting Sessions</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_Ikge" itemprop="headline">Opening a Quiri with Another User</h1><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2024-12-04T00:00:00.000Z" itemprop="datePublished">December 4, 2024</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The Problem<a class="hash-link" href="#the-problem" title="Direct link to heading">​</a></h2><p>In the current dev build of Quiri, the only way to open a conversation with a user is to know their username and to enter it perfectly in the <code>conversation partner</code> field. Here we explore ways to improve this experience, including:</p><ul><li>inviting a user via their email or phone number (3rd party identifier / 3PID)<ul><li>inviting users without an account to create an account to accept the invite and start the conversation</li></ul></li><li>a contact list or friends list to quickly open new quiris</li><li>adding a friend using their quiri userID or displayname</li></ul><p>For the MVP all rooms are to be private and 1-1 and there are no plans to help users discover one another on the platform (e.g. no public spaces for posting). Public posting is being considered for a future release.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-matrix-offers">What Matrix Offers<a class="hash-link" href="#what-matrix-offers" title="Direct link to heading">​</a></h2><p>As we are building on top of matrix, we should first attempt to leverage the features and patterns that they offer out of the box to minimize custom dev work.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inviting-a-known-user">Inviting a known user<a class="hash-link" href="#inviting-a-known-user" title="Direct link to heading">​</a></h3><p>This is the flow that we are using in the dev build today. Matrix users come with identifiers that look a lot like emails (e.g. <code>@nigel:quiri.io</code>). When you want to open a room with a user you can address it in the same way that you would address an email: know the user&#x27;s email exactly and write it correctly. If the address is wrong, the room will fail to open same as an email would fail to send.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-directory-search">User Directory Search<a class="hash-link" href="#user-directory-search" title="Direct link to heading">​</a></h3><p>Matrix servers offer the ability to <a href="https://spec.matrix.org/v1.11/client-server-api/#user-directory" target="_blank" rel="noopener noreferrer">search the user directory</a> for other users by their <code>user ID</code> or <code>display name</code>. This feature does not simply list the users though. Some search term must be passed (e.g. at least a single character like <code>a</code>) and only those users matching will be shown. As such, this is a feature that could help users find each other in two cases:</p><ul><li>the quiri userId/displayname was shared previously and the search provides some confirmation that the user actually exists and may provide suggestions if the userID/displayname was misspelt</li><li>A user can try their friend&#x27;s real name and hope they found the right person if the search returns a hit</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-options">Configuration Options<a class="hash-link" href="#configuration-options" title="Direct link to heading">​</a></h4><p>The <code>synapse</code> matrix server implementation offers <a href="https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html#user_directory" target="_blank" rel="noopener noreferrer">some configuration of the search results</a> but it is limited in it&#x27;s configurability.</p><p>At it&#x27;s most open, it returns search results for all users on the server and other servers. For the MVP this may be acceptable but as the community grows it could enable spammers to abuse the platform and harass random users.</p><p>The one restriction that is offered is to set the <code>search_all_users</code> property to false in which,</p><blockquote><p>&quot;...search results will only contain users visible in public rooms and users sharing a room with the requester.&quot;
With this flag set we might be able to use this feature to enable searching of all users you have interacted with before as long as you are still in a room with each of those users.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="third-party-invites">Third Party Invites<a class="hash-link" href="#third-party-invites" title="Direct link to heading">​</a></h3><p>Matrix offers a way to invite someone to a room using a <a href="https://spec.matrix.org/v1.12/client-server-api/#third-party-invites" target="_blank" rel="noopener noreferrer">third-party invite</a>. If the user already has an account associated with that email/phone then they are added to the room. If they don&#x27;t have an account yet, the user is sent an email inviting them to join quiri (and the room they were invited to). Once they have created an account associated with their email they can join the room.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-all-users-in-a-room">List all users in a room<a class="hash-link" href="#list-all-users-in-a-room" title="Direct link to heading">​</a></h3><p>For a given room, <a href="https://playground.matrix.org/#get-/_matrix/client/v3/rooms/-roomId-/members" target="_blank" rel="noopener noreferrer">all members in that room can be listed.</a> this does not help us with our problems directly but may be useful as a workaround for storing a contact list.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="search-a-room">Search a room<a class="hash-link" href="#search-a-room" title="Direct link to heading">​</a></h3><p>Matrix offers the <a href="https://playground.matrix.org/#post-/_matrix/client/v3/search" target="_blank" rel="noopener noreferrer">server-side indexing and search of room event contents</a>. This also does not help us directly but could enable the searching of a &quot;contact list&quot; room.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="our-solution">Our Solution<a class="hash-link" href="#our-solution" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inviting-someone-to-a-room-using-their-email">Inviting someone to a room using their email<a class="hash-link" href="#inviting-someone-to-a-room-using-their-email" title="Direct link to heading">​</a></h3><p>The built-in third party invite functionality appears to handle this. A more thorough audit should be performed against a local instance of Synapse.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="contact-list">Contact list<a class="hash-link" href="#contact-list" title="Direct link to heading">​</a></h3><p><a href="https://github.com/matrix-org/matrix-spec/issues/111" target="_blank" rel="noopener noreferrer">Matrix does not currently offer a contact list functionality</a>. If we want this functionality, the out-of-the box solution will be to create a non-chat room for each user in which only their contact list is stored. Non-chat rooms are an <a href="https://spec.matrix.org/v1.12/client-server-api/#types" target="_blank" rel="noopener noreferrer">expected use-case for Matrix</a> so it&#x27;s not terribly hacky but the functionality will be limited. The <a href="https://playground.matrix.org/#post-/_matrix/client/v3/search" target="_blank" rel="noopener noreferrer">room search feature</a> could possibly be used for filtering the contact list but sorting will likely be client side. The client will handle the logic for when a user is added/removed from a &quot;contact list&quot; room and will have to be careful to not include the contact list room in the quiri list. A more thorough audit of the room invite functionality should be performed to detail how &quot;contact list&quot; room invites and acceptances would map to &quot;contact list&quot; invites and acceptances/rejections.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-friend-to-your-contact-list">Adding a friend to your contact list<a class="hash-link" href="#adding-a-friend-to-your-contact-list" title="Direct link to heading">​</a></h3><p>For the MVP there will be two ways in which you can add a user to your friends list:</p><ul><li>knowing their email</li><li>knowing their username or display name</li></ul><p>This feels quite restricted but making user directories searchable trades the convenience of searching for users by name with the risk of users being spammed. While this is a low risk today, as the platform grows, this is the kind of thing that crushes communication platforms.</p><p>Taking Discord as a reference, they offer adding a friend strictly by username but you can add someone to a server by email.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>Overall, the user experience will be:</p><ul><li>open conversations for the first time by providing their email (or knowing their username)</li><li>a one-time use shareable add-me-as-a-friend link that can be pasted into an outside chat or email would be a nice way to make friend adding easier</li><li>open further conversations with a user via your contact list</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_u0Nl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/quiri">quiri</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/solutioning">solutioning</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/quiri-docs/blog/sending-and-accepting-room-invites"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Sending and Accepting Room Invites</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/quiri-docs/blog/starting-and-restarting-sessions"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Starting and Restarting Sessions</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The Problem</a></li><li><a href="#what-matrix-offers" class="table-of-contents__link toc-highlight">What Matrix Offers</a><ul><li><a href="#inviting-a-known-user" class="table-of-contents__link toc-highlight">Inviting a known user</a></li><li><a href="#user-directory-search" class="table-of-contents__link toc-highlight">User Directory Search</a></li><li><a href="#third-party-invites" class="table-of-contents__link toc-highlight">Third Party Invites</a></li><li><a href="#list-all-users-in-a-room" class="table-of-contents__link toc-highlight">List all users in a room</a></li><li><a href="#search-a-room" class="table-of-contents__link toc-highlight">Search a room</a></li></ul></li><li><a href="#our-solution" class="table-of-contents__link toc-highlight">Our Solution</a><ul><li><a href="#inviting-someone-to-a-room-using-their-email" class="table-of-contents__link toc-highlight">Inviting someone to a room using their email</a></li><li><a href="#contact-list" class="table-of-contents__link toc-highlight">Contact list</a></li><li><a href="#adding-a-friend-to-your-contact-list" class="table-of-contents__link toc-highlight">Adding a friend to your contact list</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div></div>
<script src="/quiri-docs/assets/js/runtime~main.2e6ac7e9.js"></script>
<script src="/quiri-docs/assets/js/main.f573e6b0.js"></script>
</body>
</html>