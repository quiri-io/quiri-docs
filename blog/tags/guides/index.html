<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/quiri-docs/blog/rss.xml" title="Quiri Docs and Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/quiri-docs/blog/atom.xml" title="Quiri Docs and Blog Atom Feed"><title data-rh="true">7 posts tagged with &quot;guides&quot; | Quiri Docs and Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://quiri-io.github.io/quiri-docs/blog/tags/guides"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="7 posts tagged with &quot;guides&quot; | Quiri Docs and Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/quiri-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://quiri-io.github.io/quiri-docs/blog/tags/guides"><link data-rh="true" rel="alternate" href="https://quiri-io.github.io/quiri-docs/blog/tags/guides" hreflang="en"><link data-rh="true" rel="alternate" href="https://quiri-io.github.io/quiri-docs/blog/tags/guides" hreflang="x-default"><link rel="stylesheet" href="/quiri-docs/assets/css/styles.e9529800.css">
<link rel="preload" href="/quiri-docs/assets/js/runtime~main.52eb4ad0.js" as="script">
<link rel="preload" href="/quiri-docs/assets/js/main.2984f24f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/quiri-docs/"><div class="navbar__logo"><img src="/quiri-docs/img/quiri_logo.svg" alt="Quiri Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/quiri-docs/img/quiri_logo.svg" alt="Quiri Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Quiri.dev</b></a><a class="navbar__item navbar__link" href="/quiri-docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/quiri-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/quiri-io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/listening-for-new-messages-with-the-matrix-sdk">Listening for New Messages With the Matrix SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/opening-a-quiri-with-another-user">Opening a Quiri with Another User</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/starting-and-restarting-sessions">Starting and Restarting Sessions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/starting-and-restarting-sessions">Starting and Restarting Sessions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/quiri-docs/blog/registering-new-users">Registering New Users with Matrix</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>7 posts tagged with &quot;guides&quot;</h1><a href="/quiri-docs/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/starting-and-restarting-sessions">Starting and Restarting Sessions</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2024-06-01T00:00:00.000Z" itemprop="datePublished">June 1, 2024</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="matrix-sdk-sessions">Matrix SDK Sessions<a class="hash-link" href="#matrix-sdk-sessions" title="Direct link to heading">​</a></h2><p>Matrix uses access tokens to authenticate user requests. The Flutter SDK handles a lot of the token management for us.</p><p>For example, when setting the user&#x27;s display name, there is no way to pass the auth token. This is because it is stored in a class variable and included in the request on our behalf.</p><p>But what happens to the access token when we shut down the app? The instance of the SDK class will be disposed and the token will go with it. This is why the Matrix Client can be provided a databaseBuilder when being created. The SDK will store the access token, amongst other things in this database and <a href="https://github.com/famedly/matrix-dart-sdk/blob/544888fe33a14e0610b2916b5069656a06aeb299/lib/src/client.dart#L1430-L1459" target="_blank" rel="noopener noreferrer">fetch them on startup</a>. This is what will allow us to keep users logged in even when the restart the app.</p><p>There remains the question of how long a client can stay logged in. It seems that the default for FluffyChat is to have long-lived access tokens. But the matrix spec allows for the use of refresh tokens for improved security.There exists a method <a href="https://github.com/famedly/matrix-dart-sdk/blob/501c457ea130481ba5b52d45d4d0ff37b8707964/lib/src/client.dart#L241-L279" target="_blank" rel="noopener noreferrer"><code>refreshAccessToken()</code> that refreshes the access token</a> but it appears that FluffyChat doesn&#x27;t use it... Looks like I&#x27;ll need to schedule a task to refresh the token. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-session-data">Other session data<a class="hash-link" href="#other-session-data" title="Direct link to heading">​</a></h2><p>While the matrix SDK has it&#x27;s own ways to persist session data, there are also cases in which we will want to persist session data (e.g. the user&#x27;s sign-up stage). For these non-matrix session data, we will use the <a href="https://pub.dev/packages/hydrated_bloc" target="_blank" rel="noopener noreferrer">Hydrated Bloc package</a> to securely persist the session data.</p><h1>State Restoration in Flutter</h1><p><a href="https://www.flutteris.com/blog/en/state_restoration" target="_blank" rel="noopener noreferrer">Thorough blog post</a></p><ul><li>maybe use this primarily for navigation state and lean on hydrated bloc for other state?</li><li><a href="https://github.com/flutter/packages/blob/main/packages/go_router/example/lib/others/state_restoration.dart" target="_blank" rel="noopener noreferrer">goRouter state restoration example</a></li><li>might need to use <a href="https://github.com/tolo/flutter_packages/blob/nested-persistent-navigation/packages/go_router/example/lib/stateful_shell_route.dart" target="_blank" rel="noopener noreferrer">statefulShellRoute?</a></li><li>state restore is only for going from background to foreground if the OS reclaims the memory because it needs it</li><li>when manually shutting down the app and restarting it, state restore does not work (at least for go_router)</li></ul><h1>Startup State Restoration</h1><ul><li>If a user has never used the app<ul><li>there is no state to restore and they should land on the landing page</li></ul></li><li>If a user has started the signup process, but has not yet registered an account (they are registered after picking their unique handle)<ul><li>return the user to where they were in the signup process</li></ul></li><li>if a user exits out of the signup process before registering via the close button in the app<ul><li>clear the app state entirely (including any signup progress)</li></ul></li><li>if a user registers an account successfully<ul><li>clear all signup state (they are signed up now, so we don&#x27;t have to go back!)</li></ul></li><li>if a user logs out after logging in<ul><li>clear all state</li></ul></li><li>if a user logs in and they have not set their avatar or display name (last step of signup that occurs after registration)<ul><li>detect when loading homepage and redirect user to create profile page<ul><li>using route guards?</li><li>create profile page needs a logout option</li><li>the display name and avatar can be attached to a User HydratedBloc so that we can cache the avatar and displayname</li></ul></li></ul></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Starting and Restarting Sessions" href="/quiri-docs/blog/starting-and-restarting-sessions"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/starting-and-restarting-sessions">Starting and Restarting Sessions</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2024-06-01T00:00:00.000Z" itemprop="datePublished">June 1, 2024</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="matrix-sdk-sessions">Matrix SDK Sessions<a class="hash-link" href="#matrix-sdk-sessions" title="Direct link to heading">​</a></h2><p>Matrix uses access tokens to authenticate user requests. The Flutter SDK handles a lot of the token management for us.</p><p>For example, when setting the user&#x27;s display name, there is no way to pass the auth token. This is because it is stored in a class variable and included in the request on our behalf.</p><p>But what happens to the access token when we shut down the app? The instance of the SDK class will be disposed and the token will go with it. This is why the Matrix Client can be provided a databaseBuilder when being created. The SDK will store the access token, amongst other things in this database and <a href="https://github.com/famedly/matrix-dart-sdk/blob/544888fe33a14e0610b2916b5069656a06aeb299/lib/src/client.dart#L1430-L1459" target="_blank" rel="noopener noreferrer">fetch them on startup</a>. This is what will allow us to keep users logged in even when the restart the app.</p><p>There remains the question of how long a client can stay logged in. It seems that the default for FluffyChat is to have long-lived access tokens. But the matrix spec allows for the use of refresh tokens for improved security.There exists a method <a href="https://github.com/famedly/matrix-dart-sdk/blob/501c457ea130481ba5b52d45d4d0ff37b8707964/lib/src/client.dart#L241-L279" target="_blank" rel="noopener noreferrer"><code>refreshAccessToken()</code> that refreshes the access token</a> but it appears that FluffyChat doesn&#x27;t use it... Looks like I&#x27;ll need to schedule a task to refresh the token. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-session-data">Other session data<a class="hash-link" href="#other-session-data" title="Direct link to heading">​</a></h2><p>While the matrix SDK has it&#x27;s own ways to persist session data, there are also cases in which we will want to persist session data (e.g. the user&#x27;s sign-up stage). For these non-matrix session data, we will use the <a href="https://pub.dev/packages/hydrated_bloc" target="_blank" rel="noopener noreferrer">Hydrated Bloc package</a> to securely persist the session data.</p><h1>State Restoration in Flutter</h1><p><a href="https://www.flutteris.com/blog/en/state_restoration" target="_blank" rel="noopener noreferrer">Thorough blog post</a></p><ul><li>maybe use this primarily for navigation state and lean on hydrated bloc for other state?</li><li><a href="https://github.com/flutter/packages/blob/main/packages/go_router/example/lib/others/state_restoration.dart" target="_blank" rel="noopener noreferrer">goRouter state restoration example</a></li><li>might need to use <a href="https://github.com/tolo/flutter_packages/blob/nested-persistent-navigation/packages/go_router/example/lib/stateful_shell_route.dart" target="_blank" rel="noopener noreferrer">statefulShellRoute?</a></li><li>state restore is only for going from background to foreground if the OS reclaims the memory because it needs it</li><li>when manually shutting down the app and restarting it, state restore does not work (at least for go_router)</li></ul><h1>Startup State Restoration</h1><ul><li>If a user has never used the app<ul><li>there is no state to restore and they should land on the landing page</li></ul></li><li>If a user has started the signup process, but has not yet registered an account (they are registered after picking their unique handle)<ul><li>return the user to where they were in the signup process</li></ul></li><li>if a user exits out of the signup process before registering via the close button in the app<ul><li>clear the app state entirely (including any signup progress)</li></ul></li><li>if a user registers an account successfully<ul><li>clear all signup state (they are signed up now, so we don&#x27;t have to go back!)</li></ul></li><li>if a user logs out after logging in<ul><li>clear all state</li></ul></li><li>if a user logs in and they have not set their avatar or display name (last step of signup that occurs after registration)<ul><li>detect when loading homepage and redirect user to create profile page<ul><li>using route guards?</li><li>create profile page needs a logout option</li><li>the display name and avatar can be attached to a User HydratedBloc so that we can cache the avatar and displayname</li></ul></li></ul></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Starting and Restarting Sessions" href="/quiri-docs/blog/starting-and-restarting-sessions"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/registering-new-users">Registering New Users with Matrix</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2024-01-29T00:00:00.000Z" itemprop="datePublished">January 29, 2024</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>For Quiri, we want to register users with a username and an email. Luckily, we can reference how Fluffychat does this!</p><p><a href="https://gitlab.com/famedly/fluffychat/-/blob/5212d7ce4d66fd1465e851aee788ca9f4f6537b8/lib/pages/connect/connect_page.dart#L31-97" target="_blank" rel="noopener noreferrer">Choosing an avatar and username</a></p><p><a href="https://gitlab.com/famedly/fluffychat/-/blob/e88ce8e91cc992885a109a39270558503aaa455f/lib/pages/sign_up/signup.dart#L76-125" target="_blank" rel="noopener noreferrer">Provide email and choose a password</a></p><p>Lets find the associated REST calls in the <a href="https://playground.matrix.org/#overview" target="_blank" rel="noopener noreferrer">matrix API spec</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="check-if-username-is-available">Check if username is available<a class="hash-link" href="#check-if-username-is-available" title="Direct link to heading">​</a></h2><p><a href="https://playground.matrix.org/#get-/_matrix/client/v3/register/available" target="_blank" rel="noopener noreferrer">Matrix spec</a></p><ul><li>no auth required</li><li>fluffychat doesn&#x27;t use this maybe because it doesn&#x27;t reserve the username?</li><li>should be useful for username selection screen</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="register">Register<a class="hash-link" href="#register" title="Direct link to heading">​</a></h2><p><a href="https://github.com/famedly/matrix-dart-sdk/blob/544888fe33a14e0610b2916b5069656a06aeb299/lib/src/client.dart#L450-L490" target="_blank" rel="noopener noreferrer">SDK code</a> | <a href="https://playground.matrix.org/#post-/_matrix/client/v3/register" target="_blank" rel="noopener noreferrer">Matrix Spec</a></p><ul><li>no auth required</li><li>when hitting the <code>matrix.org</code> server with only a username, it returns a <code>401</code> with a response body that tells you the &quot;authentication flows&quot; that are available to you for this endpoint on this server.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;session&quot;: &quot;jgIeMOlHYubxOZYzaFSMCFqJ&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;flows&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;stages&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;m.login.recaptcha&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;m.login.terms&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;m.login.email.identity&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;params&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;m.login.recaptcha&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;public_key&quot;: &quot;6LcgI54UAAAAABGdGmruw6DdOocFpYVdjYBRe4zb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;m.login.terms&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;policies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;privacy_policy&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;version&quot;: &quot;1.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;en&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;name&quot;: &quot;Terms and Conditions&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;url&quot;: &quot;https://matrix-client.matrix.org/_matrix/consent?v=1.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case the &quot;authentication&quot; is the steps that you will need to go through in order to register on this server; pass recaptcha, agree to terms and conditions and go through an email verification flow (receive an email and click the button in it)</p><p>On my local dockerized synapse instance I wanted to start with the simplest <a href="https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html" target="_blank" rel="noopener noreferrer">configuration</a> and build up from there. </p><p>The basic configuration does not allow any registrations.
Adding <code>enable_registration: true</code> will get you a startup error telling you that you shouldn&#x27;t allow registrations without some additional measures to confirm identity (like the steps above that matrix.org makes you go through). Otherwise people can spam requests to create accounts.</p><p>On my local though, it tells me that I can add <code>enable_registration_without_verification: true</code> to allow such registrations anyways.</p><p>After doing that I naively try to submit a registration request with just a username and an email:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location &#x27;localhost:8008/_matrix/client/v3/register&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;username&quot;: &quot;cheeeeky_monkey&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;password&quot;: &quot;password&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I get back this cryptic response and it does not register a user.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;session&quot;: &quot;bFygXrPrCVAOztdAJyjjDOim&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;flows&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;stages&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;m.login.dummy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;params&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After reading through the <a href="https://spec.matrix.org/v1.9/client-server-api/#user-interactive-authentication-api" target="_blank" rel="noopener noreferrer">User-Interactive Authentication API docs</a> I learned that this is my server telling me that I have one flow that I can take to authenticate this registration request. And that path is to perform no flow! All I have to do is add the auth parameter to my registration request.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;password&quot;: &quot;ilovebananas&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;username&quot;: &quot;cheeky_monkey&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;auth&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;session&quot;: &quot;qRFAzYnVJgHQdobMkUhOQlUU&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;m.login.dummy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The session is optional in this case because the flow only has a single step (multiple step flows will require sending the same session token). Including the <code>m.login.dummy</code> auth type basically is just a little hoop we have to jump through to make this request without going through any actual flow.</p><p>We registered a user! But as per that earlier error&#x27;s advice, we can&#x27;t go public with this configuration. For Quiri we want to register users with their emails so it&#x27;s time to figure out how to configure the server to require email for registration and also configure it to send the emails!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="registering-a-user-with-an-email">Registering a user with an email<a class="hash-link" href="#registering-a-user-with-an-email" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-dev-email-server">Setting up a dev email server<a class="hash-link" href="#setting-up-a-dev-email-server" title="Direct link to heading">​</a></h3><p>At first I was looking into different services like SendGrid (will probably use this for the actual deployment) but then I realized I should be able to use an SMTP server hosted in a local docker container!</p><p>So I am trying <a href="https://github.com/rnwood/smtp4dev" target="_blank" rel="noopener noreferrer">smtp4dev</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="get-the-registration-token">Get the registration token<a class="hash-link" href="#get-the-registration-token" title="Direct link to heading">​</a></h3><ul><li><a href="https://playground.matrix.org/#post-/_matrix/client/v3/register/email/requestToken" target="_blank" rel="noopener noreferrer">API doc</a></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location &#x27;localhost:8008/_matrix/client/v3/register/email/requestToken&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;client_secret&quot;: &quot;monkeys_are_GREAT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;email&quot;: &quot;alice@example.org&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;next_link&quot;: &quot;https://example.org/congratulations.html&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;send_attempt&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>the client secret is any string invented by the client</li><li>this sends the email with the validation link!</li><li>the response is an sid<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;sid&quot;: &quot;WurCLwjxFYIGiTIz&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="click-the-verification-link">Click the verification link<a class="hash-link" href="#click-the-verification-link" title="Direct link to heading">​</a></h3><ul><li>you cannot continue with registration until that link is clicked</li><li>go to <code>localhost:5005</code> for the smtp4dev interface and open the email</li><li>the link is currently https, which won&#x27;t work<ul><li>I should figure out how to make it use http for the link</li><li>for now just copy paste it from the email into the browser and edit to <code>http</code></li><li>it will redirect to a 404 page because I haven&#x27;t set up a redirect page yet</li><li>but it did succeed!</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-the-registration">Complete the registration<a class="hash-link" href="#complete-the-registration" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location &#x27;localhost:8008/_matrix/client/v3/register&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;device_id&quot;: &quot;GHTYAJCE&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;inhibit_login&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;initial_device_display_name&quot;: &quot;Jungle Phone&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;password&quot;: &quot;ilovebananas&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;refresh_token&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;username&quot;: &quot;cheeky_monkey_email&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;auth&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;session&quot;: &quot;bdZxZeFmpPxdAuSVoGalmiPC&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;m.login.email.identity&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;threepid_creds&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;sid&quot;: &quot;ygxQvHncMIMQzFTk&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;client_secret&quot;: &quot;monkeys_are_GREAT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>the sid is from the previous email registration request</li><li>the client_secret was provided in the previous email registration request</li><li>this will fail if the user has not yet clicked the link in their email</li><li>if they have clicked that link, the user is now registered, your first token is returned and we&#x27;re off!</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="email-registration-user-experience">Email Registration User Experience<a class="hash-link" href="#email-registration-user-experience" title="Direct link to heading">​</a></h2><ul><li>User is asked for email and password<ul><li>random client_secret is generated by client and stored in localstorage</li><li>request is sent to matrix to send verification email<ul><li>sid of response is held in local storage</li></ul></li><li>password is held in local storage?<ul><li>security risk?</li></ul></li></ul></li><li>User is taken to a page informing them that they must click the link in the email to continue<ul><li>include button to resend the request</li></ul></li><li>when the button is clicked in the email, we should try to send them into the app?<ul><li>or just give them a message that they should go back to the app to continue</li></ul></li><li>whenever they return to the &quot;check your email&quot; page, try to register them with no password<ul><li>if they have yet to have validated, it will respond with EMAIL_NOT_VALIDATED</li><li>if they have validated it will respond with NO_PASSWORD</li></ul></li><li>once the NO_PASSWORD response comes up, move the user through the username selection process</li><li>once they have selected a username, send the final registration request with username, password, email token (sid)<ul><li>an access token will be returned and the user is on their merry way</li></ul></li><li>make sure to remove the password from local storage!</li></ul><p>Throughout the above process, if the user closes the app and re-opens they should be brought back to the screen that they were at. The information that they provide needs to be stored in &quot;localstorage&quot; until they make the final registration call.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Registering New Users with Matrix" href="/quiri-docs/blog/registering-new-users"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/using-ory-for-auth-with-synapse">Using Ory for Auth with Synapse</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2023-10-30T00:00:00.000Z" itemprop="datePublished">October 30, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>We are now working on the designs for the MVP app which has me figuring out user signup/signin. While the matrix folks have built-in a variety of authentication methods, I am inclined to use a dedicated signup/signin service and let matrix focus on chat.</p><p>This post is my effort to lay out my understanding of the options that Synapse offers and the tradeoffs they have.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="research">Research<a class="hash-link" href="#research" title="Direct link to heading">​</a></h2><ul><li><a href="https://matrix-org.github.io/synapse/latest/usage/configuration/user_authentication/index.html" target="_blank" rel="noopener noreferrer">sparse synapse docs regarding oidc</a><ul><li>lists Hydra as a tested provider but doesn&#x27;t include it in any examples</li><li>is this the same thing as Matrix Authentication Service?</li><li>this looks like it is Matrix baking in additional authentication mechanisms rather than totally offloading the authentication to something like MAS...</li></ul></li><li><a href="https://areweoidcyet.com/" target="_blank" rel="noopener noreferrer">dedicated site regarding matrix migrating to OIDC</a><ul><li>lists MAS alongside Keycloak under OpenID Providers. Does Ory Hydra fit in the same category and why is Hydra listed as <a href="https://matrix-org.github.io/synapse/latest/openid.html" target="_blank" rel="noopener noreferrer">&quot;tested&quot; here</a> but not listed in this doc?</li></ul></li><li><a href="https://areweoidcyet.com/client-implementation-guide/" target="_blank" rel="noopener noreferrer">areweoidcyet client implementation guide</a><ul><li>provides more details on client flows</li><li>lots of details on how the client interacts with an &quot;oidc&quot; homeserver</li></ul></li><li><a href="https://playground.matrix.org/#post-/_matrix/client/v3/register" target="_blank" rel="noopener noreferrer">matrix playground account management requests</a></li><li><a href="https://spec.matrix.org/v1.8/client-server-api/#client-authentication" target="_blank" rel="noopener noreferrer">matrix spec 1.8 (including registration/authentication)</a></li><li><a href="https://github.com/matrix-org/synapse/pull/15582" target="_blank" rel="noopener noreferrer">merged PR that moves auth to OIDC</a><ul><li>merged May 2023</li><li>note the deprecation of old registration endpoints</li><li>contains detailed notes on how to run the matrix-authentication-service<ul><li>do we need to run that or is it baked in now?</li></ul></li></ul></li><li><a href="https://github.com/matrix-org/matrix-authentication-service" target="_blank" rel="noopener noreferrer">matrix-authentication-service repo</a><ul><li>can I use something like Hydra instead of MAS?</li><li>looks like you could work with Hydra as an &quot;upstream&quot; IDP but if I can just use it as the main one then why run MAS as well?</li><li><a href="https://areweoidcyet.com/#whats-this-matrix-authentication-service-that-ive-heard-about" target="_blank" rel="noopener noreferrer">some details about MAS from areweoidcyet.com</a></li></ul></li><li><a href="https://matrix-org.github.io/matrix-authentication-service/index.html" target="_blank" rel="noopener noreferrer">MAS documentation</a><ul><li>good introduction to how the matrix chat server and the auth server will interact</li></ul></li><li><a href="https://github.com/matrix-org/synapse/issues/15573" target="_blank" rel="noopener noreferrer">PR for bringing delegated auth to an official release</a><ul><li>still open</li><li>still experimental</li></ul></li><li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3861/files" target="_blank" rel="noopener noreferrer">the matrix spec change request for delegating auth</a><ul><li>has more details about the motivation and the current state of auth</li></ul></li><li><a href="https://github.com/vector-im/oidc-playground" target="_blank" rel="noopener noreferrer">Matrix OpenID Connect Playground repo</a><ul><li>this is hosted somewhere</li><li>not sure how it is useful to me</li></ul></li><li><a href="https://blog.px.dev/open-source-auth/" target="_blank" rel="noopener noreferrer">Blog post about manually integrating Kratos and Hydra (and why)</a></li><li><a href="https://github.com/ory/kratos/issues/273#issuecomment-1305388654" target="_blank" rel="noopener noreferrer">Kratos issue comment that appears to be the most complete integration guide?</a></li><li><a href="https://gruchalski.com/posts/2021-04-10-ory-reference-docker-compose-and-thoughts-on-the-platform/" target="_blank" rel="noopener noreferrer">Kratos/Hydra critique</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hosting-my-own-hydra-oidc-provider-and-using-already-built-in-oidc-to-authenticate-all-users">Hosting My Own Hydra OIDC Provider and Using Already Built-in OIDC to Authenticate All users<a class="hash-link" href="#hosting-my-own-hydra-oidc-provider-and-using-already-built-in-oidc-to-authenticate-all-users" title="Direct link to heading">​</a></h2><p>It seems that while the proposal to have all matrix clients authenticate with matrix via OIDC, it is still just a proposal and is currently experimental. I feel that I now understand how I can have users that are managed by Ory Hydra/Kratos but have accounts on my Matrix server.</p><ul><li>Kratos offers signup/signin services via API that can be used to create accounts</li><li>Hydra provides the OIDC interface so that users can &quot;login using Ory&quot; in the same way that they might &quot;sign in using google&quot;<ul><li>while google has other applications and things that you might use your google account for, my Ory deployment would only be holding their identities (not the best explanation)</li></ul></li><li>on the Matrix server side, I configure the server to only allow auth through oidc and only configure Ory as the provider<ul><li>google, auth0, etc are able to be configured as downstream providers to Ory</li></ul></li><li>if the proposal takes off, hopefully it&#x27;s not too complicated to shift to using the Hydra/Kratos as the OIDC Provider rather than MAS</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="to-investigate">To Investigate<a class="hash-link" href="#to-investigate" title="Direct link to heading">​</a></h3><ul><li>can we obscure the Matrix server to Ory auth process in a way that makes the user feel like they are using a basic login and not using a social-like signin?</li><li>how hard is it going to be to integrate Kratos and Hydra?</li><li>Is this overcomplicated?</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-passwordprovider-module-to-directly-integrate-with-kratos">Using PasswordProvider Module to Directly integrate with Kratos<a class="hash-link" href="#using-passwordprovider-module-to-directly-integrate-with-kratos" title="Direct link to heading">​</a></h2><ul><li>does this restrict the login/security options that Kratos offers?</li><li>does this reduce the complexity that much?</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="just-use-the-built-in-auth-as-it-is">Just use the built-in auth as it is<a class="hash-link" href="#just-use-the-built-in-auth-as-it-is" title="Direct link to heading">​</a></h2><ul><li>limited to the auth options that are already made available<ul><li>there are a bunch of them...</li></ul></li><li>less secure?<ul><li>another auth rewrite from a team that should be focussing on chat?</li><li>they are very security focussed though...</li></ul></li><li>looks like I&#x27;m going with this because the Kratos/Hydra integration is not looking straightforward enough at this time<ul><li>in the future that does seem like the best option</li></ul></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Using Ory for Auth with Synapse" href="/quiri-docs/blog/using-ory-for-auth-with-synapse"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/project-structure-and-state-management-in-flutter">Project Structure and State Management in Flutter</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2022-11-15T00:00:00.000Z" itemprop="datePublished">November 15, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Flutter is a compelling technology but it is not very mature so there are some challenges when it comes to filling in the functionality that is missing from the core libraries. I have spent a lot of time reading different blogs, etc. to try to get some guidance and hopefully avoid some common pitfalls. One resource that has been useful is <a href="https://codewithandrea.com/tutorials/" target="_blank" rel="noopener noreferrer">codewithandrea.com</a>. I am going to be referencing his riverpod and other architecture articles to inform my library architectural decisions.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Project Structure and State Management in Flutter" href="/quiri-docs/blog/project-structure-and-state-management-in-flutter"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/getting-started-matrix-api">Getting Started With the Matrix API</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2022-08-12T00:00:00.000Z" itemprop="datePublished">August 12, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>After some exploration of Android development (specifically jetpack compose), I finally took a proper swing at Flutter and while jetpack compose seems like a powerful tool and I would love to get to know kotlin better, the cross-platform development and cross-platform design was just too alluring. </p><p>I figured I would start with a login screen as it would get me interacting with state and making an API call. I found some widget online that gave me most of the UI, leaving me to figure out constructing the login API request from the form inputs. </p><p>At first I was wary of using an SDK that was not created by the Matrix team but the Famedly folks are actively contributing to it and when it comes down to it, it is just sending HTTP requests to the API. So the first thing was <a href="https://gitlab.com/famedly/company/frontend/famedlysdk" target="_blank" rel="noopener noreferrer">adding the SDK</a> as a dependency.</p><p>It is also important for me to start getting to know the matrix API in general so I found their <a href="https://matrix.org/docs/api/#overview" target="_blank" rel="noopener noreferrer">API reference</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Getting Started With the Matrix API" href="/quiri-docs/blog/getting-started-matrix-api"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_Ikge" itemprop="headline"><a itemprop="url" href="/quiri-docs/blog/getting-started-with-flutter">Getting Started With Flutter</a></h2><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2022-06-12T00:00:00.000Z" itemprop="datePublished">June 12, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/nigel-smk.png" alt="Nigel Maynard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nigel-smk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nigel Maynard</span></a></div><small class="avatar__subtitle" itemprop="description">Quiri Founder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>After putting quite a bit of time into getting Element for Android working as a library so that I could wrap it in my own package, I was finding that even writing a simple feature was proving difficult. I did some evaluation of the amount of energy that would be required to get up to speed with android in a way that would be required for me to make any meaningful progress on quiri and Flutter started to look more attractive.</p><p>With the wrapped Element Android version of the app distributed out to Josh, Loisel and Anton, we had collected some solid sample conversations that have helped to inform which features are essential to the quiri experience and which new features we might like to build on top of it. This has given me more confidence in building from scratch using Flutter. </p><p><a href="https://gitlab.com/famedly/company/frontend/famedlysdk" target="_blank" rel="noopener noreferrer">There is an actively maintained matrix SDK for flutter</a> as well as the <a href="https://gitlab.com/famedly/fluffychat" target="_blank" rel="noopener noreferrer">associated open-source app that depends on it (which has decent reviews in the Play Store)</a>. So my thinking is that it&#x27;s probably a similar effort for me to get up speed on android vs build from scratch in Flutter (maybe I will just build on top of fluffychat...) but if I go with Flutter at least I will understand how all of the code works (because I will write it). Whereas the experience with android right now is one of generally being frustrated and lost in a large and complex codebase. </p><p>While I feel that there is some risk that Flutter will end up being the wrong tool due to some shortcomings, <a href="https://flutter.dev/events/io-2022" target="_blank" rel="noopener noreferrer">it appears to be a pretty solid tool and Google is quite active in improving it.</a> If it plays out well, it will be easy enough to have desktop and web clients as well as android and iOS.</p><h1>Getting Started</h1><p>I had just bought a new macbook so I have had a pretty fresh start. Here are the things that I already installed:</p><ul><li>iTerm2</li><li>ohmyzsh</li><li>xcode and the xcode command line tools (big download)</li><li>vs code</li><li>android studio (to maybe write flutter in)</li><li>docker desktop</li></ul><p>For flutter I just jumped to their <a href="https://docs.flutter.dev/get-started/install" target="_blank" rel="noopener noreferrer">install homepage</a> and went from there.</p><p><code>flutter doctor</code> raised a couple of issues</p><ul><li><code>Unable to locate Android SDK.</code><ul><li>I needed to open Android Studio, which had a first time run wizard that installed the android SDK for me</li></ul></li><li><code>CocoaPods not installed.</code><ul><li>Just followed <a href="https://guides.cocoapods.org/using/getting-started.html#installation" target="_blank" rel="noopener noreferrer">their instructions</a> to install cocoapods as well.</li></ul></li><li><code>cmdline-tools component is missing</code><ul><li>on the Android Studio startup modal, click <code>More actions</code> &gt; <code>SDK Manager</code> &gt; <code>SDK Tools</code> tab &gt; check <code>Android SDK command line tools (latest)</code> and then <code>Apply</code> or <code>OK</code></li></ul></li><li><code>Android license status unknown.</code><ul><li><code>flutter doctor --android-licenses</code></li></ul></li></ul><p>I am going to start with just android devices so I need to take the <a href="https://docs.flutter.dev/get-started/install/macos#android-setup" target="_blank" rel="noopener noreferrer">Android Setup</a> steps as well.</p><h1>IDE</h1><p>I chose android studio because I imagine google has put effort into making it the ideal development experience. I could definitely see myself switching to VS code though.</p><p>I got as far as running the sample app on my device.</p><h1>Next steps</h1><p>I think that I will follow the more detailed intro to creating an app that follows this setup. And then probably go back to the Flutter course I started on Udemy a while back. </p><p>I will need to get some initial designs going with Loisel as well to help guide my efforts.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/quiri-docs/blog/tags/guides">guides</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Getting Started With Flutter" href="/quiri-docs/blog/getting-started-with-flutter"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div></div>
<script src="/quiri-docs/assets/js/runtime~main.52eb4ad0.js"></script>
<script src="/quiri-docs/assets/js/main.2984f24f.js"></script>
</body>
</html>