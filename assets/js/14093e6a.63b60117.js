"use strict";(self.webpackChunkquiri_docs=self.webpackChunkquiri_docs||[]).push([[6761],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(a),u=i,h=c["".concat(s,".").concat(u)]||c[u]||m[u]||o;return a?n.createElement(h,r(r({ref:t},d),{},{components:a})):n.createElement(h,r({ref:t},d))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},4470:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return m}});var n=a(7462),i=a(3366),o=(a(7294),a(3905)),r=["components"],l={},s="Whitelabelling Element Android",p={unversionedId:"whitelabelling-element-android",id:"whitelabelling-element-android",title:"Whitelabelling Element Android",description:"- Forking allows for easier contributing back to element should that ever happen\u2026",source:"@site/docs/whitelabelling-element-android.md",sourceDirName:".",slug:"/whitelabelling-element-android",permalink:"/quiri-docs/whitelabelling-element-android",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Server Management",permalink:"/quiri-docs/server-management"}},d={},m=[{value:"Starting steps",id:"starting-steps",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"TODO",id:"todo",level:2}],c={toc:m};function u(e){var t=e.components,a=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"whitelabelling-element-android"},"Whitelabelling Element Android"),(0,o.kt)("h1",{id:"to-fork-or-not-to-fork"},"To fork or not to fork?"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Forking allows for easier contributing back to element should that ever happen\u2026"),(0,o.kt)("li",{parentName:"ul"},"Pays respect generally to the fact that this is made from open source code"),(0,o.kt)("li",{parentName:"ul"},"Might be easier to merge their changes in later?\nSo we fork it!"),(0,o.kt)("li",{parentName:"ul"},"BUT actually forks cannot be made private soo maybe a manual mirror?",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.github.com/en/repositories/creating-and-managing-repositories/duplicating-a-repository"},"https://docs.github.com/en/repositories/creating-and-managing-repositories/duplicating-a-repository")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://blog.plataformatec.com.br/2013/05/how-to-properly-mirror-a-git-repository/"},"http://blog.plataformatec.com.br/2013/05/how-to-properly-mirror-a-git-repository/")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.edwardthomson.com/blog/mirroring_git_repositories.html"},"https://www.edwardthomson.com/blog/mirroring_git_repositories.html"),"\nLooks like the first thought actually made the most sense!"))),(0,o.kt)("li",{parentName:"ul"},"Clone the element-android project locally under the name quiri-android"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.freecodecamp.org/news/git-clone-branch-how-to-clone-a-specific-branch/"},"Only clone main as we only want to build upon releases"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"git clone -b main --single-branch --no-tags ",(0,o.kt)("a",{parentName:"li",href:"mailto:git@github.com"},"git@github.com"),":vector-im/element-android.git quiri-android"),(0,o.kt)("li",{parentName:"ul"},"Rename the main branch to element/main"),(0,o.kt)("li",{parentName:"ul"},"git branch -m element/main"),(0,o.kt)("li",{parentName:"ul"},"Rename the element remote"),(0,o.kt)("li",{parentName:"ul"},"git remote rename origin element-origin"),(0,o.kt)("li",{parentName:"ul"},"Create a new main branch (will be the quiri-android main branch)"),(0,o.kt)("li",{parentName:"ul"},"git checkout -b main"),(0,o.kt)("li",{parentName:"ul"},"Create an empty repo on github called quiri-android"),(0,o.kt)("li",{parentName:"ul"},"Add the new remote"),(0,o.kt)("li",{parentName:"ul"},"git remote add origin ",(0,o.kt)("a",{parentName:"li",href:"mailto:git@github.com"},"git@github.com"),":quiri-io/quiri-android.git"),(0,o.kt)("li",{parentName:"ul"},"Push the new remote branch to origin"),(0,o.kt)("li",{parentName:"ul"},"git push --set-upstream origin main"),(0,o.kt)("li",{parentName:"ul"},"And also push the element/main branch"),(0,o.kt)("li",{parentName:"ul"},"git checkout element/main"),(0,o.kt)("li",{parentName:"ul"},"git push --set-upstream origin"),(0,o.kt)("li",{parentName:"ul"},"And then set element/main to track the element-origin remote again"),(0,o.kt)("li",{parentName:"ul"},"git branch element/main -u element-origin/main\nNow we should lock down basically any way of modifying element/main",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"- Looks like that is a pro feature\u2026 just have to be careful for now\n")))))),(0,o.kt)("p",null,"All of the workflows were brought over with the code. They start failing and sending emails. ",(0,o.kt)("a",{parentName:"p",href:"https://docs.github.com/en/actions/managing-workflow-runs/disabling-and-enabling-a-workflow"},"They should be disabled until you figure out what they do/how to fix them.")),(0,o.kt)("h1",{id:"running-the-project-for-the-first-time-after-forking"},"Running the project for the first time after forking"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/gradle/gradle/issues/9361"},"https://github.com/gradle/gradle/issues/9361"),"\nI blindly selected the remove option. I should probably come back and understand this better in the future"),(0,o.kt)("p",null,"Then run on Pixel 4a emulator\nAnd it just runs!\nNow to change the package name so that we can release to play store under a name that we own"),(0,o.kt)("p",null,"Trying to rename the packages to io.quiri.app\nFollowed this post\nBuilt but with some warnings that may have not been there previously\u2026"),(0,o.kt)("h1",{id:"back-to-librarifying-vector"},"Back to librarifying vector"),(0,o.kt)("h2",{id:"starting-steps"},"Starting steps"),(0,o.kt)("p",null,"Read up on product flavours in libraries later\nCan\u2019t have google-services.json in library\nNow getting error: ",(0,o.kt)("inlineCode",{parentName:"p"},"incompatible types: <null> cannot be converted to int @com.airbnb.epoxy.EpoxyModelClass(layout = null)"),"\nMaybe also doesn\u2019t work well in library modules\u2026\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/airbnb/epoxy/issues/226"},"Github issue"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/59843745/epoxymodels-are-not-working-in-feature-modules-library-projects-in-android"},"The jsonviewer library project uses the EpoxyModelClass and it uses the R2.layout strategy with no complaints\u2026"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/59849994"},"Going to try this"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/42205767/context-getpackagename-vs-buildconfig-application-id"},"Got issues with APPLICATION_ID, so I swapped it for LIBRARY_PACKAGE_NAME"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/43348982"},"Using FCM in a library module"),"\nI just commented out apply plugin: ",(0,o.kt)("inlineCode",{parentName:"p"},"com.google.gms.google-services")," in the gplay flavour\n",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/46482576/java-static-final-in-kotlin-const-val-initializer-should-be-a-constant-value"},"Const ",(0,o.kt)("inlineCode",{parentName:"a"},"val")," initializer should be a constant value")),(0,o.kt)("h1",{id:"creating-the-quiri-app-module"},"Creating the Quiri app module"),(0,o.kt)("p",null,"Loosely followed this\nFile > New > Module\nName it io.quiri.app\nminSDK is 21 (see dependencies.gradle)\nShould change the quiri manifest to read minSdk from the same file\nChoose blank activity\nWhen gradle tries to resolve, it has a problem with"),(0,o.kt)("p",null,"Just remove those two lines. The IDE added them for some reason, don\u2019t know why it broke gradle\nbuild s fine as long as vector is not a dependency of quiri\nAdd vector as a dependency of quiri"),(0,o.kt)("p",null,"Had to create the flavours in quiri as well"),(0,o.kt)("h1",{id:"manifest-merging"},"Manifest Merging"),(0,o.kt)("p",null,"The quiri main./AndroidManifest.xml had these problems (merged manifest)"),(0,o.kt)("p",null,"Clicking the suggested fixes removed the errors\u2026\nAnd then it builds and installs to emulated device!"),(0,o.kt)("h1",{id:"hilt-di-errors"},"Hilt DI Errors"),(0,o.kt)("p",null,"BUT there is some issues with Hilt being used in a \u201cfeature module\u201d"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-2022-04-20",metastring:"22:22:10.520 4409-4409/io.quiri.app E/AndroidRuntime: FATAL EXCEPTION: main","22:22:10.520":!0,"4409-4409/io.quiri.app":!0,"E/AndroidRuntime:":!0,FATAL:!0,"EXCEPTION:":!0,main:!0},'    Process: io.quiri.app, PID: 4409\n    java.lang.RuntimeException: Unable to instantiate application im.vector.app.VectorApplication: java.lang.ClassNotFoundException: Didn\'t find class "im.vector.app.VectorApplication" on path: DexPathList[[zip file "/data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/base.apk"],nativeLibraryDirectories=[/data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/lib/x86, /data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/base.apk!/lib/x86, /system/lib, /system_ext/lib]]\n        at android.app.LoadedApk.makeApplication(LoadedApk.java:1244)\n        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:6683)\n        at android.app.ActivityThread.access$1300(ActivityThread.java:237)\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1913)\n        at android.os.Handler.dispatchMessage(Handler.java:106)\n        at android.os.Looper.loop(Looper.java:223)\n        at android.app.ActivityThread.main(ActivityThread.java:7656)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n     Caused by: java.lang.ClassNotFoundException: Didn\'t find class "im.vector.app.VectorApplication" on path: DexPathList[[zip file "/data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/base.apk"],nativeLibraryDirectories=[/data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/lib/x86, /data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/base.apk!/lib/x86, /system/lib, /system_ext/lib]]\n        at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:207)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:379)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:312)\n        at android.app.AppComponentFactory.instantiateApplication(AppComponentFactory.java:76)\n        at androidx.core.app.CoreComponentFactory.instantiateApplication(CoreComponentFactory.java:52)\n        at android.app.Instrumentation.newApplication(Instrumentation.java:1158)\n        at android.app.LoadedApk.makeApplication(LoadedApk.java:1236)\n        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:6683) \n        at android.app.ActivityThread.access$1300(ActivityThread.java:237) \n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1913) \n        at android.os.Handler.dispatchMessage(Handler.java:106) \n        at android.os.Looper.loop(Looper.java:223) \n        at android.app.ActivityThread.main(ActivityThread.java:7656) \n        at java.lang.reflect.Method.invoke(Native Method) \n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592) \n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947) \n        Suppressed: java.lang.NoClassDefFoundError: Failed resolution of: Lim/vector/app/Hilt_VectorApplication;\n        at java.lang.VMClassLoader.findLoadedClass(Native Method)\n        at java.lang.ClassLoader.findLoadedClass(ClassLoader.java:738)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:363)\n                ... 14 more\n     Caused by: java.lang.ClassNotFoundException: Didn\'t find class "im.vector.app.Hilt_VectorApplication" on path: DexPathList[[zip file "/data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/base.apk"],nativeLibraryDirectories=[/data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/lib/x86, /data/app/~~HJX48J0ULpskvHJ8JQO44Q==/io.quiri.app-tcmSBf87Qu2FfwNszXOYZw==/base.apk!/lib/x86, /system/lib, /system_ext/lib]]\n        at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:207)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:379)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:312)\n                ... 17 more\n')),(0,o.kt)("p",null,"Looks like there is specific way to use hilt in a feature module\nBasic Hilt\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/dependency-injection/hilt-android"},"https://developer.android.com/training/dependency-injection/hilt-android"),"\nHilt with \u201cfeature modules\u201d\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/dependency-injection/hilt-multi-module"},"https://developer.android.com/training/dependency-injection/hilt-multi-module"),"\nTried just following the instructions for Basic Hilt setup in the quiri gradle file\nHad to do this for kotlin(\u201ckapt\u201d)\nAaand got some fresh errors related to kapt"),(0,o.kt)("p",null,"I just needed to add hilt dependencies into the quiri gradle in the same way that they were added to the vector gradle"),(0,o.kt)("p",null,"Weird layout-inflater issue\nBefore this problem I had a problem that seemed to do with the fact that quiri app had a layout xml with the same name as one in vector\nJust removed the layout xml that was created with the project and its associated activity\n",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/58554751/java-lang-nullpointerexception-missing-required-view-with-id"},"https://stackoverflow.com/questions/58554751/java-lang-nullpointerexception-missing-required-view-with-id"),"\nThen I get a very non-descript error about the layout inflater\nThis guy describes the problem in more details ",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/44143105"},"https://stackoverflow.com/a/44143105"),"\nThis guy talks about how to debug it ",(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/40112945"},"https://stackoverflow.com/a/40112945")),(0,o.kt)("p",null,"So I just add an \u201cany java exception\u201d breakpoint and then start adding conditions to skip common exceptions until I hit something interesting\n",(0,o.kt)("a",{parentName:"p",href:"https://www.jetbrains.com/help/idea/using-breakpoints.html#breakpoint_condition"},"https://www.jetbrains.com/help/idea/using-breakpoints.html#breakpoint_condition"),"\nMy condition:\n!(this instanceof ErrnoException) && !(this instanceof UnixException) && !(this instanceof FileAlreadyExistsException) && !(this instanceof ClassNotFoundException) && !(this instanceof NoSuchFileException) && !(this instanceof FileNotFoundException)\nThere was some stackoverflow that talked about appcompat being a part of the problem\u2026 I lost that one"),(0,o.kt)("p",null,"Same for logintoucharea"),(0,o.kt)("p",null,"SOLUTION\nI just had to remove the application tag from the quiri AndroidManifest.xml\nIt is clear that I don\u2019t understand what I am doing but at least it is building now. It will be interesting to see how I will actually start adding my own components while using their code\u2026"),(0,o.kt)("h1",{id:"first-attempt-notes"},"First attempt notes"),(0,o.kt)("h2",{id:"getting-started"},"Getting Started"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"pulled the code"),(0,o.kt)("li",{parentName:"ul"},'used "import existing code" to import the project'),(0,o.kt)("li",{parentName:"ul"},"got a sync error",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"something about sha256 hash maybe causing errors"),(0,o.kt)("li",{parentName:"ul"},'chose the "remove that setting" option'))),(0,o.kt)("li",{parentName:"ul"},"then build starts!",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"This version of the Android Support plugin for IntelliJ IDEA (or Android Studio) cannot open this project, please retry with version 4.2 or newer."),(0,o.kt)("li",{parentName:"ul"},"upgraded android studio"),(0,o.kt)("li",{parentName:"ul"},"opted to give more memory to android studio heap when prompted"),(0,o.kt)("li",{parentName:"ul"},"I don't recall if I installed JDK 1.8 previously but it seemed to be needed"),(0,o.kt)("li",{parentName:"ul"},"had issues with running avd on my macbook. Running on device now instead")))),(0,o.kt)("h2",{id:"todo"},"TODO"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"change some code and debug something"),(0,o.kt)("li",{parentName:"ul"},"change app config to connect to local",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"org/matrix/android/sdk/api/Matrix.kt",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"the configuration gets injected in here?"),(0,o.kt)("li",{parentName:"ul"},"I need to learn more about android..."))),(0,o.kt)("li",{parentName:"ul"},"this is the config class src/main/java/org/matrix/android/sdk/api/MatrixConfiguration.kt",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"does it fetch values from a config file somewhere? I want to be able to set it to my local machine for dev",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"and to the quiri server otherwise"))))),(0,o.kt)("li",{parentName:"ul"},"I think this is the main place that it loads config from: src/main/java/im/vector/app/VectorApplication.kt",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"for now I can just hardcode the integrationUrl into VectorApplciation?"))),(0,o.kt)("li",{parentName:"ul"},"this is the thing that lods those URLs src/main/java/org/matrix/android/sdk/internal/session/integrationmanager/IntegrationManager.kt",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},'this is for the "integration manager" ',(0,o.kt)("a",{parentName:"li",href:"https://element.io/element-matrix-store"},"https://element.io/element-matrix-store"),", NOT the chat server"))),(0,o.kt)("li",{parentName:"ul"},"search for homeserver in the code yadoi"))),(0,o.kt)("li",{parentName:"ul"},"how to connect to locally running matrix server from device",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/4779963/how-can-i-access-my-localhost-from-my-android-device"},"https://stackoverflow.com/questions/4779963/how-can-i-access-my-localhost-from-my-android-device"))))))}u.isMDXComponent=!0}}]);