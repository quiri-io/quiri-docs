<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Server Management/server-management">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/quiri-docs/blog/rss.xml" title="Quiri Docs and Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/quiri-docs/blog/atom.xml" title="Quiri Docs and Blog Atom Feed"><title data-rh="true">server-management | Quiri Docs and Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://quiri-io.github.io/quiri-docs/Server Management/server-management"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="server-management | Quiri Docs and Blog"><meta data-rh="true" name="description" content="Server Management"><meta data-rh="true" property="og:description" content="Server Management"><link data-rh="true" rel="icon" href="/quiri-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://quiri-io.github.io/quiri-docs/Server Management/server-management"><link data-rh="true" rel="alternate" href="https://quiri-io.github.io/quiri-docs/Server Management/server-management" hreflang="en"><link data-rh="true" rel="alternate" href="https://quiri-io.github.io/quiri-docs/Server Management/server-management" hreflang="x-default"><link rel="stylesheet" href="/quiri-docs/assets/css/styles.e9529800.css">
<link rel="preload" href="/quiri-docs/assets/js/runtime~main.2e6ac7e9.js" as="script">
<link rel="preload" href="/quiri-docs/assets/js/main.f573e6b0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/quiri-docs/"><div class="navbar__logo"><img src="/quiri-docs/img/quiri_logo.svg" alt="Quiri Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/quiri-docs/img/quiri_logo.svg" alt="Quiri Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Quiri.dev</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/quiri-docs/">Docs</a><a class="navbar__item navbar__link" href="/quiri-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/quiri-io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quiri-docs/">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/quiri-docs/App Architecture/streaming-repositories-with-bloc">App Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/quiri-docs/App Deployment and DIstribution/adding-fcm">App Deployment and DIstribution</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/quiri-docs/Getting Started/getting-started-with-flutter">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/quiri-docs/Server Management/server-management">Server Management</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/quiri-docs/Server Management/server-management">server-management</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/quiri-docs/Understanding Matrix and the Dart Matrix SDK/app-lifecycle-state-management">Understanding Matrix and the Dart Matrix SDK</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/quiri-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Server Management</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">server-management</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>server-management</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="server-management">Server Management<a class="hash-link" href="#server-management" title="Direct link to heading">​</a></h2><p>Currently there is only a staging instance of the synapse server live. It is deployed to a machine that we have on DigitalOcean using an ansible script. The script takes a plain linux box and sets it up to run the synapse server. <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy" target="_blank" rel="noopener noreferrer">This is the original ansible script.</a> We have a fork of this repo under the quiri-io organization to hold our configurations.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-digitalocean-droplet">Setting up the DigitalOcean droplet<a class="hash-link" href="#setting-up-the-digitalocean-droplet" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-an-ssh-key-to-be-associated-with-the-droplet"><a href="https://docs.digitalocean.com/products/droplets/how-to/add-ssh-keys/to-account/" target="_blank" rel="noopener noreferrer">Configure an SSH key to be associated with the droplet</a><a class="hash-link" href="#configure-an-ssh-key-to-be-associated-with-the-droplet" title="Direct link to heading">​</a></h3><p>I named my ssh key locally to id_rsa_matrix_quiri, and stored a passphrase for it in Bitwarden</p><ul><li>the private/public key are also in bitwarden<ul><li>you will need to create the files manually and paste the contents in and then use the chmod commands that are attached to them to set their permissions appropriately</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-droplet-using-terraform">Create the droplet using terraform<a class="hash-link" href="#create-the-droplet-using-terraform" title="Direct link to heading">​</a></h3><p>See the <a href="https://github.com/quiri-io/quiri-infra" target="_blank" rel="noopener noreferrer">quiri-infra repo</a> for the terraform code and how to deploy it.
A successful <code>terraform apply</code> will output the public IP of the droplet required to run the ansible playbook to install matrix on the droplet.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dns-configuration">DNS Configuration<a class="hash-link" href="#dns-configuration" title="Direct link to heading">​</a></h2><p>The registrar for <code>quiri.io</code> is google <code>Cloud Domains</code> (in my <strong>personal</strong> GCP account under the <code>quiri-domain</code> project).
The DNS records are managed in GCP <code>Cloud DNS</code> (in my <strong>quiri.io</strong> GCP account under the <code>quiri-domain</code> project). The <code>matrix.quiri.io</code> and <code>element.quiri.io</code> domains are pointing to the DigitalOcean droplet
as per the <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-dns.md" target="_blank" rel="noopener noreferrer">DNS Setup instructions</a> from the ansible script</p><p>The base domain is pointing to the vercel-hosted landing page. This complicates the setup because the <code>.well-known</code> files need to be hosted at the base domain. One option is to <a href="https://vercel.com/docs/edge-network/redirects#vercel-functions" target="_blank" rel="noopener noreferrer">add redirects into Vercel.</a>
<a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-base-domain-serving.md#serving-a-more-complicated-website-at-the-base-domain" target="_blank" rel="noopener noreferrer">There are other options as well.</a> For now it seems that this may not have an impact on us as we are not federating with any other matrix servers and may be able to work around the lack of a <code>.well-known</code> client file on the base domain.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h3><p>When installing matrix on the server before the DNS was configured, traefik would use the default certificate for SSL which browsers do not trust. Traefik does some magic where they create a LetsEncrypt cert (or other cert depending on how you configure it) when you make a request to it. It seems that there are some requests being made to the droplet (crawlers?) that are causing traefik to use the default cert. Once the DNS record is propagated and the droplet is associated with <code>matrix.quiri.io</code> it seems that it continues to use the default traefik cert. Re-running the ansible script at this time appears to clear out the certs and resolve the issue. One way to avoid this is to wait for the matrix installation to be complete before pointing the DNS to it. This is not an ideal deployment process.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sendgrid-as-smtp-relay">SendGrid as SMTP relay<a class="hash-link" href="#sendgrid-as-smtp-relay" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-sendgrid">Set up SendGrid<a class="hash-link" href="#set-up-sendgrid" title="Direct link to heading">​</a></h3><ul><li>create a SendGrid account</li><li>create a sender called <code>noreply@quiri.io</code></li><li>associate <code>noreply@quiri.io</code> alternative email with my quiri email in Google Admin console</li><li><a href="https://www.twilio.com/docs/sendgrid/ui/account-and-settings/how-to-set-up-domain-authentication" target="_blank" rel="noopener noreferrer">authenticate the domain</a> by adding some DNS records (to improve deliverability)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-matrix-to-use-the-sendgrid">Configure matrix to use the Sendgrid<a class="hash-link" href="#configure-matrix-to-use-the-sendgrid" title="Direct link to heading">​</a></h3><ul><li><a href="https://app.sendgrid.com/settings/api_keys" target="_blank" rel="noopener noreferrer">create sendgrid API key</a> with send permissions</li><li>refer to the <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-email.md#relaying-email-through-another-smtp-server" target="_blank" rel="noopener noreferrer">playbook docs</a> for what to set in the <code>vars.yml</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-ansible-playbook"><a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook.md#configuring-the-ansible-playbook" target="_blank" rel="noopener noreferrer">Configuring the Ansible Playbook</a><a class="hash-link" href="#configuring-the-ansible-playbook" title="Direct link to heading">​</a></h2><ul><li>the <code>vars.yml</code> file configures a number of ansible script behaviours but is also used to generate the <code>homeserver.yaml</code><ul><li>see <a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/6b87d1aa7d24ce99578a252317670c80e4891be2/examples/vars.yml" target="_blank" rel="noopener noreferrer">the example <code>vars.yml</code></a> provided by the ansible playbook owners</li><li>to map settings from the development <code>homeserver.yaml</code> to the deployed <code>homeserver.yaml</code> find the associated ansible variable in the <a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/f0cc5da229a83526b35690cad628552b59dae563/roles/custom/matrix-synapse/templates/synapse/homeserver.yaml.j2" target="_blank" rel="noopener noreferrer"><code>homeserver.yaml.j2</code> template</a> and set it in the <code>vars.yml</code></li><li>the most recent <code>vars.yml</code> is in bitwarden under <code>ansible vars.yml</code></li></ul></li><li>the <code>hosts</code> file is in bitwarden under <code>ansible hosts file</code><ul><li>set <code>ansible_host</code> to the public IP of the DigitalOcean droplet</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-ansible-script">Running the ansible script<a class="hash-link" href="#running-the-ansible-script" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/master/docs/ansible.md#running-ansible-in-a-container-on-another-computer-not-the-matrix-server" target="_blank" rel="noopener noreferrer">I used the &quot;run ansible in docker from your local machine&quot; option</a></li><li>this is the command I used to start the container and get to the shell prompt:<ul><li><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -it --rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -w /work \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -v `pwd`:/work \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -v $HOME/.ssh/id_rsa_matrix_quiri:/root/.ssh/id_rsa:ro \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -v $HOME/.ssh/id_ed25519:/root/.ssh/id_ed25519:ro \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --entrypoint=/bin/sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    docker.io/devture/ansible:2.18.1-r0-0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>I changed the mapping to the id_rsa file because I gave it a non-standard name</li><li>I also mapped my github ssh key to the container so that I could run the <code>just update</code> successfully</li></ul></li><li><a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/master/docs/installing.md" target="_blank" rel="noopener noreferrer">Then follow the instructions to run the ansible script in the container</a><ul><li>the script will ask for the password for the private key. You can find it in bitwarden as a custom field under <code>id_rsa_matrix_quiri private key</code></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-admin-user">Set up admin user<a class="hash-link" href="#set-up-admin-user" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/registering-users.md" target="_blank" rel="noopener noreferrer">register first admin user manually</a></li><li><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-synapse-admin.md" target="_blank" rel="noopener noreferrer">then set up the synapse admin</a><ul><li>and create other users there</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-synapse">Upgrading Synapse<a class="hash-link" href="#upgrading-synapse" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/quiri-io/matrix-docker-ansible-deploy/blob/master/docs/maintenance-upgrading-services.md" target="_blank" rel="noopener noreferrer">there are specific steps to follow when upgrading</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="notes-on-potentially-deploying-a-custom-matrix-docker-image-in-the-future-using-the-same-script">Notes on potentially deploying a custom matrix docker image in the future using the same script<a class="hash-link" href="#notes-on-potentially-deploying-a-custom-matrix-docker-image-in-the-future-using-the-same-script" title="Direct link to heading">​</a></h2><ul><li><p>We are developing on top of synapse and thus need to be deploying our version of synapse rather than the one distributed on dockerhub</p></li><li><p>Since we are using DigitalOcean for the server right now, we will also use <a href="https://www.digitalocean.com/products/container-registry" target="_blank" rel="noopener noreferrer">the digital ocean private container registry</a></p></li><li><p>New images are pushed to <a href="https://docs.digitalocean.com/products/container-registry/how-to/use-registry-docker-kubernetes/" target="_blank" rel="noopener noreferrer">the registry from local</a></p></li><li><p>The ansible scripts need to be updated to accept login details and then pull from the private registry</p></li><li><p>Looks like you can build from a git repo… but then you would need to have the ssh key… probably just do the docker login separately and pull from the private repo</p><ul><li>The docker image that is pulled for synapse is set here <code>roles/matrix-synapse/defaults/main.yml</code></li></ul></li><li><p>The actual pull happens here roles/matrix-synapse/tasks/synapse/setup_install.yml</p><ul><li>There is a way to have matrix built from a repository BUT it looks like it will need to be a public repo. And it needs to use the same versioning that the official repo does</li></ul></li><li><p>Looks like the way forward is to add a new option that pulls from a provided registry URL after logging in to the private repo (if the repo is private)</p></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/quiri-docs/Getting Started/getting-started-with-matrix-api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Getting Started With the Matrix API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/quiri-docs/Understanding Matrix and the Dart Matrix SDK/app-lifecycle-state-management"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">App Lifecycle State Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#server-management" class="table-of-contents__link toc-highlight">Server Management</a></li><li><a href="#setting-up-the-digitalocean-droplet" class="table-of-contents__link toc-highlight">Setting up the DigitalOcean droplet</a><ul><li><a href="#configure-an-ssh-key-to-be-associated-with-the-droplet" class="table-of-contents__link toc-highlight">Configure an SSH key to be associated with the droplet</a></li><li><a href="#create-the-droplet-using-terraform" class="table-of-contents__link toc-highlight">Create the droplet using terraform</a></li></ul></li><li><a href="#dns-configuration" class="table-of-contents__link toc-highlight">DNS Configuration</a><ul><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li><li><a href="#sendgrid-as-smtp-relay" class="table-of-contents__link toc-highlight">SendGrid as SMTP relay</a><ul><li><a href="#set-up-sendgrid" class="table-of-contents__link toc-highlight">Set up SendGrid</a></li><li><a href="#configure-matrix-to-use-the-sendgrid" class="table-of-contents__link toc-highlight">Configure matrix to use the Sendgrid</a></li></ul></li><li><a href="#configuring-the-ansible-playbook" class="table-of-contents__link toc-highlight">Configuring the Ansible Playbook</a></li><li><a href="#running-the-ansible-script" class="table-of-contents__link toc-highlight">Running the ansible script</a></li><li><a href="#set-up-admin-user" class="table-of-contents__link toc-highlight">Set up admin user</a></li><li><a href="#upgrading-synapse" class="table-of-contents__link toc-highlight">Upgrading Synapse</a></li><li><a href="#notes-on-potentially-deploying-a-custom-matrix-docker-image-in-the-future-using-the-same-script" class="table-of-contents__link toc-highlight">Notes on potentially deploying a custom matrix docker image in the future using the same script</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/quiri-docs/assets/js/runtime~main.2e6ac7e9.js"></script>
<script src="/quiri-docs/assets/js/main.f573e6b0.js"></script>
</body>
</html>